<!DOCTYPE html>
<html>

<head>
  <title>External Devices Tables (Read-Only)</title>
  <style>
    body { background: #f7f7f9; }
    table {
      border-collapse: collapse;
      width: 100%;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 40px;
    }
    th, td {
      padding: 10px 12px;
      text-align: left;
    }
    th {
      background: #f0f2f5;
      font-weight: 600;
      border-bottom: 2px solid #e0e0e0;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    tr:nth-child(even) td {
      background: #f9fafb;
    }
    tr:hover td {
      background: #e6f7ff;
    }
    input.filter-input {
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      padding: 4px 6px;
      font-size: 1em;
      margin-top: 4px;
      width: 90%;
      box-sizing: border-box;
    }
    nav {
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    }
    button[onclick^="showTable"] {
      transition: background 0.2s, color 0.2s;
      border-radius: 4px;
      padding: 4px 10px;
    }
    button[onclick^="showTable"]:hover {
      background: #0074d9;
      color: #fff;
    }
    h1, h2 {
      font-family: 'Segoe UI', 'Arial', sans-serif;
      color: #222;
    }
    h2 {
      margin-top: 30px;
    }
  </style>
</head>

<body style="margin:0; font-family:sans-serif;">


<nav style="background:#222; color:#fff; padding:10px 0; margin-bottom:30px;">
  <div style="max-width:900px; margin:0 auto; display:flex; gap:30px; align-items:center;">
    <span style="font-weight:bold; font-size:1.2em;">External Devices</span>
    <button onclick="showTable('routers')" style="color:#fff; background:none; border:none; cursor:pointer; font-size:1em;">DevicesROUTERS</button>
    <button onclick="showTable('nanoenvi')" style="color:#fff; background:none; border:none; cursor:pointer; font-size:1em;">DevicesNANOENVI</button>
    <button onclick="showTable('co2')" style="color:#fff; background:none; border:none; cursor:pointer; font-size:1em;">DevicesCO2</button>
    <button onclick="showMockup()" style="color:#fff; background:none; border:none; cursor:pointer; font-size:1em;">Carga masiva</button>
  </div>
</nav>




<div id="mockup-loader" style="display:none; max-width:900px; margin:0 auto; background:#fff; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.04); padding:24px 24px 12px 24px; margin-bottom:30px;">
  <h2>Carga masiva de dispositivos</h2>
  <input type="file" id="mockup-file" accept="application/json" style="margin-bottom:10px;">
  <button onclick="loadMockupFile()" style="padding:4px 12px;">Load File</button>
  <div id="mockup-table-container" style="margin-top:20px;"></div>
</div>

<div style="max-width:900px; margin:0 auto;">

<h1>External Devices Tables (Read-Only)</h1>

<form method="get" style="margin-bottom:30px; display:flex; gap:10px; align-items:center;">
  <label for="name">Filter by name:</label>
  <input type="text" id="name" name="name" value="{{ name_filter }}" style="padding:4px 8px;">
  <button type="submit" style="padding:4px 12px;">Filter</button>
  {% if name_filter %}
    <a href="?" style="margin-left:10px; color:#0074d9; text-decoration:underline;">Clear</a>
  {% endif %}
</form>

{% load get_field %}


<div id="table-routers">
  <h2>DevicesROUTERS</h2>
  <table border="1" style="width:100%; margin-bottom:40px;" id="routers-table">
    <thead>
      <tr>
        {% for field in router_fields %}
          <th>{{ field }}<br><input type="text" class="filter-input" data-table="routers-table" data-col="{{ forloop.counter0 }}" style="width:90%"></th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
    {% for obj in routers %}
    <tr>
      {% for field in router_fields %}
        <td>{{ obj|get_field:field }}</td>
      {% endfor %}
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>


<div id="table-nanoenvi" style="display:none;">
  <h2>DevicesNANOENVI</h2>
  <table border="1" style="width:100%; margin-bottom:40px;" id="nanoenvi-table">
    <thead>
      <tr>
        {% for field in nanoenvi_fields %}
          <th>{{ field }}<br><input type="text" class="filter-input" data-table="nanoenvi-table" data-col="{{ forloop.counter0 }}" style="width:90%"></th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
    {% for obj in nanoenvi %}
    <tr>
      {% for field in nanoenvi_fields %}
        <td>{{ obj|get_field:field }}</td>
      {% endfor %}
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>


<div id="table-co2" style="display:none;">
  <h2>DevicesCO2</h2>
  <table border="1" style="width:100%; margin-bottom:40px;" id="co2-table">
    <thead>
      <tr>
        {% for field in co2_fields %}
          <th>{{ field }}<br><input type="text" class="filter-input" data-table="co2-table" data-col="{{ forloop.counter0 }}" style="width:90%"></th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
    {% for obj in co2 %}
    <tr>
      {% for field in co2_fields %}
        <td>{{ obj|get_field:field }}</td>
      {% endfor %}
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>


</script>
<script>
function showTable(table) {
  document.getElementById('mockup-loader').style.display = 'none';
  document.getElementById('table-routers').style.display = (table === 'routers') ? '' : 'none';
  document.getElementById('table-nanoenvi').style.display = (table === 'nanoenvi') ? '' : 'none';
  document.getElementById('table-co2').style.display = (table === 'co2') ? '' : 'none';
}

function showMockup() {
  document.getElementById('mockup-loader').style.display = '';
  document.getElementById('table-routers').style.display = 'none';
  document.getElementById('table-nanoenvi').style.display = 'none';
  document.getElementById('table-co2').style.display = 'none';
}

function loadMockupFile() {
  var fileInput = document.getElementById('mockup-file');
  var container = document.getElementById('mockup-table-container');
  container.innerHTML = '';
  if (!fileInput.files.length) return;
  var file = fileInput.files[0];
  var reader = new FileReader();
  reader.onload = function(e) {
    try {
      var data = JSON.parse(e.target.result);
      if (!Array.isArray(data)) data = [data];
      if (!data.length) { container.innerHTML = '<em>No data in file</em>'; return; }
      var fields = Object.keys(data[0]);
      var html = '<table style="width:100%; border-collapse:collapse;">';
      html += '<thead><tr>' + fields.map(f => `<th style=\"background:#f0f2f5; padding:10px 12px;\">${f}</th>`).join('') + '</tr></thead>';
      html += '<tbody>';
      data.forEach(row => {
        html += '<tr>' + fields.map(f => `<td style=\"padding:10px 12px;\">${row[f] ?? ''}</td>`).join('') + '</tr>';
      });
      html += '</tbody></table>';
      container.innerHTML = html;
    } catch (err) {
      container.innerHTML = '<span style="color:red;">Invalid JSON file</span>';
    }
  };
  reader.readAsText(file);
}

// Table filtering by any field
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.filter-input').forEach(function(input) {
    input.addEventListener('input', function() {
      var tableId = input.getAttribute('data-table');
      var col = parseInt(input.getAttribute('data-col'));
      var table = document.getElementById(tableId);
      var filter = input.value.toLowerCase();
      var rows = table.querySelectorAll('tbody tr');
      rows.forEach(function(row) {
        var cell = row.children[col];
        if (!cell) return;
        var text = cell.textContent.toLowerCase();
        // Check all filters for this row
        var show = true;
        input.parentElement.parentElement.querySelectorAll('.filter-input').forEach(function(otherInput, idx) {
          var otherFilter = otherInput.value.toLowerCase();
          if (otherFilter && row.children[idx] && row.children[idx].textContent.toLowerCase().indexOf(otherFilter) === -1) {
            show = false;
          }
        });
        row.style.display = show ? '' : 'none';
      });
    });
  });
});
</script>
</script>

</div>

</body>
</html>
